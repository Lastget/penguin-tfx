steps:
- name: 'gcr.io/cloud-builders/git'
  args: ['clone', '--single-branch', '--branch',
         '$_BRANCH','$_REPO_URL',
         '--depth', '1',
         '--verbose']
  id: 'Clone Repository'

- name: 'gcr.io/cloud-builders/gsutil'
  args: ['cp', 'penguine_tfx/modules/*.py', 'gs://$_PROJECT-vertex-default/pipeline_module/$_PIPELINE_NAME']
  id: 'Copy Modules'
  waitFor: ['Clone Repository']

- name: 'gcr.io/cloud-builders/gsutil'
  args: ['cp', 'penguine_tfx/modules/data/*.csv', 'gs://$_PROJECT-vertex-default/data/$_PIPELINE_NAME']
  id: 'Copy Data'
  waitFor: ['Copy Modules']

- name: 'gcr.io/tfx-oss-public/tfx:1.14.0'
  entrypoint: 'python'
  args: ['penguine_tfx/tfx-pipeline/kubeflow_runner.py']
  id: 'Run Pipeline'
  waitFor: ['Copy Data']