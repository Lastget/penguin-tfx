steps:
- name: 'gcr.io/cloud-builders/git'
  args: ['clone', '--single-branch', '--branch',
         '$_BRANCH','$_REPO_URL',
         '--depth', '1',
         '--verbose']
  id: 'Clone Repository'

- name: 'gcr.io/cloud-builders/gsutil'
  args: ['cp', 'model.py', 'gs://$_PROJECT-vertex-default/pipeline_module/$_PIPELINE_NAME']
  dir: 'modules'
  id: 'Copy Modules'
  waitFor: ['Clone Repository']

- name: 'gcr.io/cloud-builders/gsutil'
  args: ['cp', 'penguins_processed.csv', 'gs://$_PROJECT-vertex-default/data/$_PIPELINE_NAME']
  dir: 'modules/data'
  id: 'Copy Data'
  waitFor: ['Copy Modules']

- name: 'gcr.io/tfx-oss-public/tfx:1.14.0'
  entrypoint: 'python'
  args: ['kubeflow_runner.py']
  dir: 'tfx-pipeline'
  id: 'Run Pipeline'
  waitFor: ['Copy Data']